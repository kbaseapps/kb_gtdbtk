#
# define display information
#
name: Classify Microbes with GTDB-Tk - v2.1.0

tooltip: |
    Obtain objective taxonomic assignments for bacterial and archaeal genomes based on the Genome Taxonomy Database (GTDB) ver R07-RS207

screenshots: [GTDB_Report.png]

icon: icon.jpg

#
# define a set of similar apps that might be useful to the user
#
suggestions:
    apps:
        related:
            [app1, app2]
        next:
            [app3, app4]

#
# Configure the display and description of parameters
#
parameters :
    input_object_ref :
        ui-name : |
            Input
        short-hint : |
            A binned contigs object, assembly set, or genome set
        long-hint  : |
            An assembly set or genome set.  Also accepts Binned Contigs object.  Use Build AssemblySet or Build GenomeSet if have just one object.
    output_tree_basename :
        ui-name : |
            Tree Base Name
        short-hint : |
            The basename for the Tree objects.  There are often multiple trees, so each tree object name will extend the output Tree Base Name.
    min_perc_aa :
        ui-name : |
            Minimum Alignment Percent
        short-hint : |
            Filter out genomes with an insufficient percentage of AAs in the MSA (default: 10)
    copy_proximals :
        ui-name : |
            Copy GTDB hits (for genomes)
        short-hint : |
            Copy proximal GTDB hits to this narrative and create GenomeSets for each query and overall.
    save_trees :
        ui-name : |
            Save Trees (for genomes)
        short-hint : |
            Save all trimmed GTDB trees as KBase objects.  Does not save full tree with all leaves, just what is displayed in report.  Copies over genome objects in trees.
    full_tree :
        ui-name : |
            Full Tree
        short-hint : |
            Perform tree placement with full tree or class-level subtrees
    keep_intermediates :
        ui-name : |
            Keep Intermediate Files
        short-hint : |
            Retain intermediate files generated by classify_wf
    overwrite_tax :
        ui-name : |
            Overwrite Taxonomy (for genomes)
        short-hint : |
            If input is a GenomeSet that already has taxonomy defined, then overwrite Genome objects with GTDB classification
    dendrogram_report :
        ui-name : |
            Dendrogram Trees in Report
        short-hint : |
            Show Trees as dendrogram instead of evolutionary distance-based branch lengths


description : |
    <h3>Description</h3>
    <p><b><a href="https://github.com/Ecogenomics/GTDBTk">GTDB-Tk v2.1.0</a></b> is a software toolkit for assigning objective taxonomic classifications to bacterial and archaeal genomes. It is designed to work with recent advances that allow hundreds or thousands of metagenome-assembled genomes (MAGs) to be obtained directly from environmental samples. It can also be applied to isolate and single-cell genomes. If the input is a GenomeSet, the App will optionally overwrite the Taxonomy information in the Genome object(s).</p>

    <p>Notes:</p>
    <p>As of v2.0.0, the GTDB-Tk Classify workflow by default uses order-level subtrees rather than the entire Bacterial tree.  This uses far less memory.  An option to use the full tree is provided.</p>
    <p>As of v2.0.0, intermediate files in the classification workflow are deleted.  An option to keep those intermediate files is provided.</p>
    <p>Individual Genome objects must first be placed into a GenomeSet to be used as input.  This is to avoid accidentally running the App multiple times, once for each Genome, which is very inefficient.  Similarly, individual Assembly objects must be placed into an AssemblySet object.  The utility Apps Build GenomeSet or Build AssemblySet can be used for this purpose.</p>

    <p><hr></p>
    <p><h3>Tool and Data Sources:</h3></p>
    <p>GTDB-Tk v2.1.0 is installed from <a href="https://github.com/Ecogenomics/GTDBTk">https://github.com/Ecogenomics/GTDBTk</a></p>

    <p>This app is using gtdbtk release 207 data <a href="https://data.gtdb.ecogenomic.org/releases/release207/207.0/auxillary_files/gtdbtk_r207_v2_data.tar.gz">https://data.gtdb.ecogenomic.org/releases/release207/207.0/auxillary_files/gtdbtk_r207_v2_data.tar.gz</a> (warning: clicking on link will start download 62.74 GB of data). This reference data corresponds to the GTDB R07-RS207 release.</p>
    <b>About GTDB </b>
    <a href='https://gtdb.ecogenomic.org/'>The Genome Taxonomy Database (GTDB)</a> is constructed from RefSeq and Genbank genomes, and releases are indexed to RefSeq releases. All genomes are quality controlled using <a href='https://github.com/Ecogenomics/CheckM/wiki'>CheckM</a> and those statistics can be found on the <a href='https://gtdb.ecogenomic.org/stats'>GTDB website</a>.

    <p><hr></p>
    <h3>Usage</h3>

    <h4>GTDB Species Tree Tab</h4>
    
    <p><b><i>dendrogram / ultrametric tree</i></b><br>
    <img src="https://raw.githubusercontent.com/kbaseapps/kb_gtdbtk/dylan_20230607/ui/narrative/methods/run_kb_gtdbtk_classify_wf/img/gtdbtk.ar53.classify-trimmed.tree-circle-ultrametric.png"></p>

    <p><b><i>phylogenetic tree</i></b><br>
    <img src="https://raw.githubusercontent.com/kbaseapps/kb_gtdbtk/dylan_20230607/ui/narrative/methods/run_kb_gtdbtk_classify_wf/img/gtdbtk.ar53.classify-trimmed.tree-circle.png"></p>

    <p><b><i>rectangular tree</i></b><br>
    <img src="https://raw.githubusercontent.com/kbaseapps/kb_gtdbtk/dylan_20230607/ui/narrative/methods/run_kb_gtdbtk_classify_wf/img/gtdbtk.ar53.classify-trimmed.tree-rectangle.png"></p>

    <p><b><i>bacterial trees</i></b><br>
    <img src="https://raw.githubusercontent.com/kbaseapps/kb_gtdbtk/dylan_20230607/ui/narrative/methods/run_kb_gtdbtk_classify_wf/img/gtdbtk.ar53.classify-trimmed.tree-circle-ultrametric.png"></p>


    <h4>Genome objects</h4>
    

    <h4>Genome Sets</h4>



    <h4>Krona Plot Tab</h4>
    <img src="https://raw.githubusercontent.com/kbaseapps/kb_gtdbtk/dylan_20230607/ui/narrative/methods/run_kb_gtdbtk_classify_wf/img/GTDB_Krona.png">


    <h4>Bacteria and Archaea Classification Tabs</h4>
    <img src="https://raw.githubusercontent.com/kbaseapps/kb_gtdbtk/dylan_20230607/ui/narrative/methods/run_kb_gtdbtk_classify_wf/img/GTDB_Classification-1.png">
    <p>
    <img src="https://raw.githubusercontent.com/kbaseapps/kb_gtdbtk/dylan_20230607/ui/narrative/methods/run_kb_gtdbtk_classify_wf/img/GTDB_Classification-2.png">


    <h4>Bacteria and Archaea Marker Gene Tabs</h4>
    <img src="https://raw.githubusercontent.com/kbaseapps/kb_gtdbtk/dylan_20230607/ui/narrative/methods/run_kb_gtdbtk_classify_wf/img/GTDB_Marker_gene_summary.png">


    <h4>Downloadable Files</h4>
    <img src="https://raw.githubusercontent.com/kbaseapps/kb_gtdbtk/dylan_20230607/ui/narrative/methods/run_kb_gtdbtk_classify_wf/img/GTDB_Download_files.png">
    

    <p><hr></p>
    <p><strong>Team members who implemented App in KBase:</strong> <a href="https://narrative.kbase.us/#people/dylan">Dylan Chivian</a> and <a href="https://narrative.kbase.us/#people/psdehal">Paramvir Dehal</a>. For questions, please <a href=”http://www.kbase.us/support/”>contact us</a>.</p>

    <p>If you use GTDB-Tk in KBase, please cite</p>
    <ul><li>Chivian D, Jungbluth SP, Dehal PS, Wood-Charlson EM, Canon RS, Allen BH, Clark MM, Gu T, Land ML, Price GA, Riehl WJ, Sneddon MW, Sutormin R, Zhang Q, Cottingham RW, Henry CS, Arkin AP. Metagenome-assembled genome extraction and analysis from microbiomes using KBase. Nat Protoc. 2023 Jan;18(1):208-238. doi: 10.1038/s41596-022-00747-x
    </ul>

    <b>Primary References</b>
    <p>GTDB-Tk is described in:</p>
        <ul>
            <li>Chaumeil PA, Mussig AJ, Hugenholtz P, Parks DH. 2019. <a href="https://academic.oup.com/bioinformatics/advance-article-abstract/doi/10.1093/bioinformatics/btz848/5626182" rel="nofollow">GTDB-Tk: A toolkit to classify genomes with the Genome Taxonomy Database</a>. <i>Bioinformatics</i>, btz848.</li>
        </ul>
    <p>The Genome Taxonomy Database (GTDB) is described in:</p>
        <ul>
            <li>Parks DH, et al. 2020. <a href="https://www.nature.com/articles/s41587-020-0501-8" rel="nofollow"> A complete domain-to-species taxonomy for Bacteria and Archaea.</a> <i>Nat Biotechnol.</i> 2020;10.1038/s41587-020-0501-8. <a href='https://www.nature.com/articles/s41587-020-0501-8'>DOI:10.1038/s41587-020-0501-8</a>.</li>
            <li>Parks DH, et al. 2018. <a href="https://www.nature.com/articles/nbt.4229" rel="nofollow">A standardized bacterial taxonomy based on genome phylogeny substantially revises the tree of life</a>. <i>Nat. Biotechnol.</i>, <a href="http://dx.doi.org/10.1038/nbt.4229" rel="nofollow">http://dx.doi.org/10.1038/nbt.4229</a>.</li>
        </ul>
    

    <p>We also strongly encourage you to cite the following 3rd party dependencies:</p>
    <ul>
        <li>
        Matsen FA, Kodner RB, Armbrust EV. 2010. <a href="https://www.ncbi.nlm.nih.gov/pubmed/21034504">pplacer: linear time maximum-likelihood and Bayesian phylogenetic placement of sequences onto a fixed reference tree</a>. <i>BMC Bioinformatics</i>, 11:538.
        </li>
        <li>
        Jain C, et al. 2017. <a href="https://www.biorxiv.org/content/early/2017/11/27/225342">High-throughput ANI Analysis of 90K Prokaryotic Genomes Reveals Clear Species Boundaries</a>. <i>bioRxiv</i>, <a href="https://doi.org/10.1101/225342">https://doi.org/10.1101/225342</a>.
        </li>
        <li>
        Hyatt D, et al. 2010. <a href="https://www.ncbi.nlm.nih.gov/pubmed/20211023">Prodigal: prokaryotic gene recognition and translation initiation site identification</a>. <i>BMC Bioinformatics</i>, 11:119. doi: 10.1186/1471-2105-11-119.
        <li>
        Price MN, Dehal PS, Arkin AP. 2010. <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2835736/">FastTree 2 - Approximately Maximum-Likelihood Trees for Large Alignments</a>. <i>PLoS One</i>, 5, e9490.
        </li>
        <li>
        Eddy SR. 2011. <a href="https://www.ncbi.nlm.nih.gov/pubmed/22039361">Accelerated profile HMM searches</a>. <i>PLOS Comp. Biol.</i>, 7:e1002195.
        </li>
    </ul>
    
publications : 
    -
        pmid: 31730192
        display-text: |
            Pierre-Alain Chaumeil, Aaron J Mussig, Philip Hugenholtz, Donovan H Parks, GTDB-Tk: a toolkit to classify genomes with the Genome Taxonomy Database, Bioinformatics, Volume 36, Issue 6, 15 March 2020, Pages 1925–1927. DOI: https://doi.org/10.1093/bioinformatics/btz848
        link: https://doi.org/10.1093/bioinformatics/btz848
    -
        pmid: 30148503
        display-text: |
            Parks, D., Chuvochina, M., Waite, D. et al. A standardized bacterial taxonomy based on genome phylogeny substantially revises the tree of life. Nat Biotechnol 36, 996–1004 (2018). DOI: https://doi.org/10.1038/nbt.4229
        link: http://dx.doi.org/10.1038/nbt.4229
    -
        pmid: 32341564
        display-text: |
            Parks DH, Chuvochina M, Chaumeil PA, Rinke C, Mussig AJ, Hugenholtz P. A complete domain-to-species taxonomy for Bacteria and Archaea. Nat Biotechnol. 2020;10.1038/s41587-020-0501-8. DOI:10.1038/s41587-020-0501-8        
        link: https://www.nature.com/articles/s41587-020-0501-8
    -
        pmid: 34155373
        display-text: |
            Rinke C, Chuvochina M, Mussig AJ, Chaumeil PA, Davín AA, Waite DW, Whitman WB, Parks DH, and Hugenholtz P. A standardized archaeal taxonomy for the Genome Taxonomy Database. Nat Microbiol. 2021 Jul;6(7):946-959. DOI:10.1038/s41564-021-00918-8
        link: https://www.nature.com/articles/s41564-021-00918-8
    -
        pmid: 21034504
        display-text: |
            Matsen FA, Kodner RB, Armbrust EV. pplacer: linear time maximum-likelihood and Bayesian phylogenetic placement of sequences onto a fixed reference tree. BMC Bioinformatics. 2010;11:538. Published 2010 Oct 30. doi:10.1186/1471-2105-11-538
        link: https://pubmed.ncbi.nlm.nih.gov/21034504/
    -
        pmid: 36376589
        display-text: |
            Chivian D, Jungbluth SP, Dehal PS, Wood-Charlson EM, Canon RS, Allen BH, Clark MM, Gu T, Land ML, Price GA, Riehl WJ, Sneddon MW, Sutormin R, Zhang Q, Cottingham RW, Henry CS, Arkin AP. Metagenome-assembled genome extraction and analysis from microbiomes using KBase. Nat Protoc. 2023 Jan;18(1):208-238. doi: 10.1038/s41596-022-00747-x
        link: https://www.nature.com/articles/s41596-022-00747-x
    -
        pmid: 30504855
        display-text: |
            Jain C, Rodriguez-R LM, Phillippy AM, Konstantinidis KT, Aluru S. High throughput ANI analysis of 90K prokaryotic genomes reveals clear species boundaries. Nat Commun. 2018;9(1):5114. Published 2018 Nov 30. DOI:10.1038/s41467-018-07641-9
        link: https://www.nature.com/articles/s41467-018-07641-9
    -
        pmid: 20211023
        display-text: |
            Hyatt D, Chen GL, Locascio PF, Land ML, Larimer FW, Hauser LJ. Prodigal: prokaryotic gene recognition and translation initiation site identification. BMC Bioinformatics. 2010;11:119. Published 2010 Mar 8. DOI:10.1186/1471-2105-11-119
        link: https://pubmed.ncbi.nlm.nih.gov/20211023/
    -   
        pmid: 20224823
        display-text: |
            Price MN, Dehal PS, Arkin AP. FastTree 2--approximately maximum-likelihood trees for large alignments. PLoS One. 2010;5(3):e9490. Published 2010 Mar 10. DOI:10.1371/journal.pone.0009490
            link: https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2835736/
    -   
        pmid: 22039361
        display-text: |
            Eddy SR. Accelerated Profile HMM Searches. PLoS Comput Biol. 2011;7(10):e1002195. DOI:10.1371/journal.pcbi.1002195
        link: https://pubmed.ncbi.nlm.nih.gov/22039361/      
    
